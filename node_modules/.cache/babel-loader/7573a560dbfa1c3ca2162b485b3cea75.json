{"ast":null,"code":"\"use strict\";\n\nvar express = require('express');\n\nvar pluralize = require('pluralize');\n\nvar delay = require('./delay');\n\nmodule.exports = function (opts) {\n  var router = express.Router();\n  router.use(delay); // Rewrite URL (/:resource/:id/:nested -> /:nested) and request query\n\n  function get(req, res, next) {\n    var prop = pluralize.singular(req.params.resource);\n    req.query[\"\".concat(prop).concat(opts.foreignKeySuffix)] = req.params.id;\n    req.url = \"/\".concat(req.params.nested);\n    next();\n  } // Rewrite URL (/:resource/:id/:nested -> /:nested) and request body\n\n\n  function post(req, res, next) {\n    var prop = pluralize.singular(req.params.resource);\n    req.body[\"\".concat(prop).concat(opts.foreignKeySuffix)] = req.params.id;\n    req.url = \"/\".concat(req.params.nested);\n    next();\n  }\n\n  return router.get('/:resource/:id/:nested', get).post('/:resource/:id/:nested', post);\n};","map":null,"metadata":{},"sourceType":"script"}