{"ast":null,"code":"\"use strict\";\n\nvar fs = require('fs');\n\nvar path = require('path');\n\nvar express = require('express');\n\nvar logger = require('morgan');\n\nvar cors = require('cors');\n\nvar compression = require('compression');\n\nvar errorhandler = require('errorhandler');\n\nvar bodyParser = require('./body-parser');\n\nmodule.exports = function (opts) {\n  var userDir = path.join(process.cwd(), 'public');\n  var defaultDir = path.join(__dirname, '../../public');\n  var staticDir = fs.existsSync(userDir) ? userDir : defaultDir;\n  opts = Object.assign({\n    logger: true,\n    static: staticDir\n  }, opts);\n  var arr = []; // Compress all requests\n\n  if (!opts.noGzip) {\n    arr.push(compression());\n  } // Enable CORS for all the requests, including static files\n\n\n  if (!opts.noCors) {\n    arr.push(cors({\n      origin: true,\n      credentials: true\n    }));\n  }\n\n  if (process.env.NODE_ENV === 'development') {\n    // only use in development\n    arr.push(errorhandler());\n  } // Serve static files\n\n\n  arr.push(express.static(opts.static)); // Logger\n\n  if (opts.logger) {\n    arr.push(logger('dev', {\n      skip: function skip(req) {\n        return process.env.NODE_ENV === 'test' || req.path === '/favicon.ico';\n      }\n    }));\n  } // No cache for IE\n  // https://support.microsoft.com/en-us/kb/234067\n\n\n  arr.push(function (req, res, next) {\n    res.header('Cache-Control', 'no-cache');\n    res.header('Pragma', 'no-cache');\n    res.header('Expires', '-1');\n    next();\n  }); // Read-only\n\n  if (opts.readOnly) {\n    arr.push(function (req, res, next) {\n      if (req.method === 'GET') {\n        next(); // Continue\n      } else {\n        res.sendStatus(403); // Forbidden\n      }\n    });\n  } // Add middlewares\n\n\n  if (opts.bodyParser) {\n    arr.push(bodyParser);\n  }\n\n  return arr;\n};","map":null,"metadata":{},"sourceType":"script"}